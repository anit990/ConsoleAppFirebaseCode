@model Question
@{
    var quizId = ViewBag.QuizId as int?;
}

<h2>Add Question</h2>

<form asp-action="AddQuestion" method="post" enctype="multipart/form-data">
    <input type="hidden" name="quizId" value="@quizId" />

    <div class="mb-3">
        <label>Question Text</label>
        <input asp-for="Text" class="form-control" />
    </div>

    <div class="mb-3">
        <label>Question Type</label>
        <select asp-for="Type" class="form-select" id="qType">
            <option>Textbox</option>
            <option>Radio</option>
            <option>Checkbox</option>
            <option>Dropdown</option>
        </select>
    </div>

    <div class="mb-3">
        <label>Image (optional)</label>
        <input type="file" name="imageFile" class="form-control" />
    </div>

    <div id="optionsArea" style="display:none;" class="mb-3">
        <label>Options</label>
        <div id="optionsContainer">
            <!-- dynamic option boxes go here -->
        </div>
        <button type="button" class="btn btn-sm btn-success mt-2" onclick="addOption()">+ Add Option</button>
    </div>

    <button type="submit" class="btn btn-primary">Save Question</button>
</form>

@section Scripts {
<script>
    const qType = document.getElementById("qType");
    const optionsArea = document.getElementById("optionsArea");
    const optionsContainer = document.getElementById("optionsContainer");

    qType.addEventListener("change", toggleOptions);

    function toggleOptions() {
        if (qType.value === "Radio" || qType.value === "Checkbox" || qType.value === "Dropdown") {
            optionsArea.style.display = "block";
            if (optionsContainer.children.length === 0) {
                addOption();
                addOption();
            }
        } else {
            optionsArea.style.display = "none";
            optionsContainer.innerHTML = "";
        }
    }

    function addOption(value = "") {
        const div = document.createElement("div");
        div.classList.add("input-group", "mb-2");

        const input = document.createElement("input");
        input.type = "text";
        input.name = "Options";
        input.value = value;
        input.classList.add("form-control");

        const btn = document.createElement("button");
        btn.type = "button";
        btn.classList.add("btn", "btn-danger");
        btn.textContent = "Remove";
        btn.onclick = () => div.remove();

        div.appendChild(input);
        div.appendChild(btn);
        optionsContainer.appendChild(div);
    }

    toggleOptions();
</script>
}
